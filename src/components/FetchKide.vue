<script>

export default {
    data() {
        return {
            kideData: {


            },
            imgUrl: "https://portalvhdsp62n0yt356llm.blob.core.windows.net/bailataan-mediaitems/",
            isDataFetched: false,
            orgs: {
                TLK:
                {
                    kideUrl: "https://api.kide.app/api/companies/8216a1bc-760d-407b-9c77-5e26a041a25c",
                    kideData: {}
                },

                HanSe:
                {
                    kideUrl: "https://api.kide.app/api/companies/90d58532-87be-4a30-b4e3-6053db20caa5",
                    kideData: {}
                },

                Hosk: {
                    kideUrl: "https://api.kide.app/api/companies/45719a1d-a1ef-44a5-ab61-3d81f23614b5",
                    kideData: {}
                },

                Commedia:
                {
                    kideUrl: "https://api.kide.app/api/companies/b7b04c01-6c49-4c74-81da-9f4147aca6db",
                    kideData: {}
                },

                Kult:
                {
                    kideUrl: "https://api.kide.app/api/companies/d12f83ed-8efa-40d9-8288-e62f1ac8fc43",
                    kideData: {}
                }
            }
        }
    },

    props: {
        bim: String,
        widgetMode: Boolean
    },

    methods: {
        async fetchKide(bim) {
            console.log("fetchKide()");

            try {
                for (const org in this.orgs) {
                    await fetch(this.orgs[org].kideUrl)
                        .then(res => res.json())
                        .then(data => {
                            this.orgs[org].kideData = data;
                        })
                }
                this.isDataFetched = true;
            }

            catch (error) {
                console.log("Could not fetch kide, " + error);
            }
        },

        getBackgroundColor(forening) {
            switch (forening) {
                case 'Commedia rf':
                    return { borderColor: 'rgba(213, 70, 60, .7)' };
                case 'HanSe SF':
                    return { borderColor: 'rgba(255, 220, 44, 0.7)' };
                case 'Hosk rf':
                    return { borderColor: 'rgba(41,105,55, .7)' };
                case 'Kult rf':
                    return { borderColor: 'rgba(94, 189, 179, .7)' };
                case 'Tekniska Läroverkets Kamratförbund r.f.':
                    return { borderColor: 'rgba(68, 71, 164, .7)' };
                default:
                    return { borderColor: 'white' };
            }
        },

        /*hoverEvent(event) {
            if (event == "stop") {
                const hoverCont = document.querySelector("#hoverCont");
                hoverCont.style.opacity = "0";
            }
            else if (this.$parent.isMobile() == false) {

                const hoverCont = document.querySelector("#hoverCont");
                hoverCont.style.opacity = "1";
                const hoverImg = document.querySelector(".hoverImg");
                const hoverName = document.querySelector(".hoverName");
                const hoverDate = document.querySelector(".hoverDate");
                hoverImg.src = this.imgUrl + event.mediaFilename;
                hoverName.innerHTML = event.name;
                hoverDate.innerHTML = new Date(event.dateActualFrom).toLocaleDateString('fi-FI');

                // In i html event
                @mouseover="hoverEvent(event)" @mouseleave="hoverEvent('stop')"
            }
        }*/

    },
    mounted() {
        this.fetchKide()
    },

}

</script>

<template>
    <div id="events" v-if="isDataFetched"
        :style="[widgetMode == true ? { 'position': 'static', 'height': '50vh', 'transform': 'translate(0, 0)' } : {}]">
        <div class='föreningar' v-for="forening in orgs" :key="forening">
            <div class="event" v-for="event in forening.kideData.model.events" :key="event.id"
                :style="getBackgroundColor(event.companyName)">
                <a :href="['https://kide.app/events/' + event.id]">
                    <div class="image-container">
                        <img class="img" :src="imgUrl + event.mediaFilename" />
                        <div class="details" :style="[event.salesStarted === true ? event.salesOngoing === false ? { 'background-color': 'rgba(255,255,255,0.7)' } : {/* Försäljning startad inte avslutad */} : {/* Inte startad inte avslutad */}]">
                            <!--<div class="name">{{ event.name }}</div>
                        <div class="date">{{ new Date(event.dateActualFrom).toLocaleDateString('fi-FI') }}</div>-->
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- <div id="hoverCont" v-if="this.$parent.isMobile() == false && this.widgetMode == false">
        <div class="hoverEvent">
            <div class="hover-image-container">
                <img class="hoverImg" />
                <div class="hoverDetails">
                    <div class="hoverName"></div>
                    <div class="hoverDate"></div>
                </div>
            </div>
        </div>
    </div> -->
</template>

<style scoped>
/* CSS mobile */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

h2 {
    font-size: 40px;
    margin: 0;
    text-align: center;
}

#events {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50vw, -50vh);
    display: flex;
    align-items: center;
    flex-direction: column;
    overflow-y: scroll;
    overflow-x: hidden;
    padding: 2vh 0 2vh 0;
    height: 90vh;
    width: 100vw;
    gap: 15px;

    .föreningar {
        background-color: rgba(68, 71, 164, .7);
        border-radius: 20px;
        width: fit-content;
        height: auto;
    }

    .föreningar:empty {
        display: none;

    }
}

.event {
    border-radius: 15px;
    overflow: hidden;
    height: 150px;
    margin: 10px;
    /*border: 5px solid;*/
    width: 85vw;
    max-width: 400px;
    height: auto;
    cursor: pointer;
}

.image-container {
    position: relative;
    width: 100%;
    height: 100%;
}

.img {
    display: block;
    width: 100%;
    height: auto;
}


.details {
    font-family: 'Quicksand';
    font-weight: 700;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 0;
    line-height: 1;
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.name {
    text-align: center;
    font-size: 30px;
    z-index: 12;
}

.date {
    text-align: center;
    font-size: 25px;

}

/* CSS Desktop */
@media screen and (min-width: 768px) {
    #events {
        -ms-overflow-style: none;
        /* IE and Edge */
        scrollbar-width: none;
        /* Firefox */


    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    #events::-webkit-scrollbar {
        display: none;
    }

    .event {
        width: 35vw;

    }

    #events {
    
    display: flex;
    flex-direction: row;
    overflow-y: scroll;
    overflow-x: scroll;
    padding: 2vh 0 2vh 0;
    height: 90vh;
    width: 100vw;
    gap: 15px;

    .föreningar {
        background-color: rgba(68, 71, 164, .7);
        border-radius: 20px;
        width: fit-content;
        height: fit-content;
        margin: auto auto auto auto;
    }
}

}
</style>